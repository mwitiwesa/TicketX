{% extends 'base.html' %}
{% load static %}

{% block title %}Home - TicketX{% endblock %}

{% block content %}

  <!-- Background: your local photo (blurred & subtle) -->
  <div style="position: fixed; inset: 0; width: 100%; height: 100%; 
              background: url('{% static 'img/background.jpg' %}') no-repeat center center / cover;
              filter: blur(8px); opacity: 1.90; z-index: -2;"></div>

  <!-- Main content container (on top of background) -->
  <div style="position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 2rem 1rem;">
    

    <h1 style="text-align: center; margin-bottom: 2.5rem; color: #fff; text-shadow: 0 2px 8px rgba(0,0,0,0.7);">
      Welcome to TicketX
    </h1>

    <!-- Events Today – slim vertical cards -->
    <section style="margin-bottom: 3.5rem;">
      <h2 style="font-size: 1.7rem; text-align: center; margin-bottom: 1.8rem; color: #fff;">
        Events Today ({{ today|date:"F j, Y" }})
      </h2>

      {% if events_today %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.3rem;">
          {% for event in events_today %}
            <div style="background: rgba(30, 30, 40, 0.85); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.4); transition: transform 0.2s;">
              <!-- Slim portrait image -->
              {% if event.image %}
                <img src="{{ event.image.url }}" alt="{{ event.title }}"
                     style="width: 100%; height: 220px; object-fit: cover;">
              {% else %}
                <div style="width: 100%; height: 220px; background: #1e1e2e; display: flex; align-items: center; justify-content: center; color: #777;">
                  No image
                </div>
              {% endif %}

              <!-- Compact info -->
              <div style="padding: 0.9rem 1rem;">
                <h3 style="font-size: 1.1rem; margin: 0 0 0.5rem; line-height: 1.3;">
                  <a href="{% url 'events:event_detail' event.pk %}" style="color: #ff5252; text-decoration: none;">
                    {{ event.title }}
                  </a>
                </h3>
                <p style="font-size: 0.85rem; color: #bbb; margin: 0 0 0.4rem;">
                  {{ event.event_time }} • {{ event.location|default:"TBA" }}
                </p>
                <p style="font-size: 0.8rem; color: #aaa; line-height: 1.4; margin: 0;">
                  {{ event.description|truncatewords:20 }}
                </p>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p style="text-align: center; font-style: italic; color: #aaa; font-size: 1.1rem;">
          No events scheduled for today.
        </p>
      {% endif %}
    </section>

    <!-- Upcoming Events – slim list -->
    <section style="margin-bottom: 4.5rem;">
      <h2 style="font-size: 1.7rem; text-align: center; margin-bottom: 1.5rem; color: #fff;">
        Upcoming Events
      </h2>

      {% if upcoming %}
        <div style="max-width: 700px; margin: 0 auto;">
          <ul style="list-style: none; padding: 0;">
            {% for event in upcoming %}
              <li style="margin-bottom: 1.2rem; padding: 0.8rem; background: rgba(30, 30, 40, 0.7); border-radius: 8px;">
                <strong style="font-size: 1.1rem;">
                  <a href="{% url 'events:event_detail' event.pk %}" style="color: #ff5252; text-decoration: none;">
                    {{ event.title }}
                  </a>
                </strong>
                <br>
                <span style="color: #bbb; font-size: 0.9rem;">
                  {{ event.event_date|date:"F j, Y" }} at {{ event.event_time }}
                </span>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% else %}
        <p style="text-align: center; font-style: italic; color: #aaa; font-size: 1.1rem;">
          No upcoming events in the next week.
        </p>
      {% endif %}
    </section>

    <!-- Calendar – bottom -->
    <section style="background: rgba(20, 20, 30, 0.9); color: #eee; padding: 1.8rem; border-radius: 12px; max-width: 900px; margin: 0 auto;">
      <h2 style="text-align: center; color: #ff4444; margin-bottom: 1.4rem;">
        Event Calendar – {{ month_name }} {{ year }}
      </h2>

      <div class="calendar-nav" style="text-align: center; margin-bottom: 1.3rem;">
        <a href="?year={{ prev_year }}&month={{ prev_month }}" style="color: #ff6666; margin: 0 1.2rem; text-decoration: none; font-weight: bold;">« Prev</a>
        <span style="font-size: 1.15rem;">{{ month_name }} {{ year }}</span>
        <a href="?year={{ next_year }}&month={{ next_month }}" style="color: #ff6666; margin: 0 1.2rem; text-decoration: none; font-weight: bold;">Next »</a>
      </div>

      <div class="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; font-size: 0.9rem;">
        <div style="font-weight: bold; padding: 6px; background: #222; text-align: center; color: #ccc;">Mon</div>
        <div style="font-weight: bold; padding: 6px; background: #222; text-align: center; color: #ccc;">Tue</div>
        <div style="font-weight: bold; padding: 6px; background: #222; text-align: center; color: #ccc;">Wed</div>
        <div style="font-weight: bold; padding: 6px; background: #222; text-align: center; color: #ccc;">Thu</div>
        <div style="font-weight: bold; padding: 6px; background: #222; text-align: center; color: #ccc;">Fri</div>
        <div style="font-weight: bold; padding: 6px; background: #222; text-align: center; color: #ccc;">Sat</div>
        <div style="font-weight: bold; padding: 6px; background: #222; text-align: center; color: #ccc;">Sun</div>

        {% for day in calendar_days %}
          {% if day %}
            <div class="day {% if day.has_event %}has-event{% endif %} {% if day.is_today %}today{% endif %}"
                 data-year="{{ year }}" data-month="{{ month }}" data-day="{{ day.day }}"
                 style="padding: 8px; text-align: center; background: #1a1a1a; border: 1px solid #2a2a2a; cursor: pointer; min-height: 40px;">
              {{ day.day }}
            </div>
          {% else %}
            <div style="padding: 8px; background: #0d0d0d; border: 1px solid #222;"></div>
          {% endif %}
        {% endfor %}
      </div>

      <div id="day-events" style="margin-top: 1.4rem; padding: 1rem; background: #1a1a1a; border: 1px solid #333; min-height: 70px; border-radius: 8px;">
        <p style="text-align: center; color: #aaa; font-size: 0.95rem;">Click a red day to see events</p>
      </div>
    </section>

  </div>

  <style>
    .has-event {
      background: #8b0000 !important;
      color: white !important;
      font-weight: bold;
    }
    .today {
      border: 2px solid #ff5252 !important;
      background: #3d0000 !important;
    }
    .calendar-nav a:hover {
      color: #ff9999 !important;
    }
  </style>

  <script>
    document.querySelectorAll('.day[data-day]').forEach(day => {
      day.addEventListener('click', function() {
        const year = this.dataset.year;
        const month = this.dataset.month;
        const dayNum = this.dataset.day;

        fetch(`/calendar/events/?year=${year}&month=${month}&day=${dayNum}`)
          .then(response => response.json())
          .then(data => {
            const target = document.getElementById('day-events');
            if (data.html) {
              target.innerHTML = data.html;
            } else if (data.error) {
              target.innerHTML = '<p style="color:#ff6666;">' + data.error + '</p>';
            } else {
              target.innerHTML = '<p style="color:#aaa;">No data returned</p>';
            }
          })
          .catch(error => {
            console.error('Fetch error:', error);
            document.getElementById('day-events').innerHTML = '<p style="color:#ff6666;">Failed to load events</p>';
          });
      });
    });
  </script>

{% endblock %}